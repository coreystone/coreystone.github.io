<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><script defer src="https://cloud.umami.is/script.js" data-website-id="3efdfbc7-1f77-426b-9741-c24e85df1d7e"></script>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Encrypted cloud backups with Cryptomator | Corey Stone</title>
<meta name="keywords" content="FOSS, privacy, security">
<meta name="description" content="I heard you like encryption, so I encrypted your encrypted backups.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/posts/encrypted-cloud-backups/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.cd0c10bc3cbe679e2e41b40a4edfe5a6f5e2a27e696a2b7f0aa7e1b9874ad556.css" integrity="sha256-zQwQvDy&#43;Z54uQbQKTt/lpvXion5pait/CqfhuYdK1VY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/encrypted-cloud-backups/">

<meta name="twitter:title" content="Encrypted cloud backups with Cryptomator | Corey Stone" />
<meta name="twitter:description" content="I heard you like encryption, so I encrypted your encrypted backups." />
<meta property="og:title" content="Encrypted cloud backups with Cryptomator | Corey Stone" />
<meta property="og:description" content="I heard you like encryption, so I encrypted your encrypted backups." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/encrypted-cloud-backups/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2021-12-18T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2021-12-18T00:00:00&#43;00:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Encrypted cloud backups with Cryptomator",
      "item": "http://localhost:1313/posts/encrypted-cloud-backups/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Encrypted cloud backups with Cryptomator | Corey Stone",
  "name": "Encrypted cloud backups with Cryptomator",
  "description": "I heard you like encryption, so I encrypted your encrypted backups.",
  "keywords": [
    "FOSS", "privacy", "security"
  ],
  "wordCount" : "1269",
  "inLanguage": "en",
  "datePublished": "2021-12-18T00:00:00Z",
  "dateModified": "2021-12-18T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/encrypted-cloud-backups/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Corey Stone",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Corey Stone (Alt + H)">Corey Stone</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="About Me"
                >About Me
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Blog" class="active"
                >Blog
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/notes/" title="Notes"
                >Notes
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects/" title="Projects"
                >Projects
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div><h1 class="post-title">Encrypted cloud backups with Cryptomator</h1>
    <div class="post-description">I heard you like encryption, so I encrypted your encrypted backups.</div>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>December 18, 2021</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="http://localhost:1313/tags/foss/">FOSS</a><a href="http://localhost:1313/tags/privacy/">Privacy</a><a href="http://localhost:1313/tags/security/">Security</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>6 min</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#encrypted-cloud-storage" aria-label="Encrypted cloud storage">Encrypted cloud storage</a></li>
                <li>
                    <a href="#file-encryption" aria-label="File encryption">File encryption</a></li>
                <li>
                    <a href="#things-youll-need" aria-label="Things you&rsquo;ll need">Things you&rsquo;ll need</a></li>
                <li>
                    <a href="#create-an-encrypted-vault" aria-label="Create an encrypted vault">Create an encrypted vault</a></li>
                <li>
                    <a href="#uploading-to-the-cloud" aria-label="Uploading to the cloud">Uploading to the cloud</a></li>
                <li>
                    <a href="#accessing-files-in-the-cloud" aria-label="Accessing files in the cloud">Accessing files in the cloud</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">¶</a></h2>
<p>I&rsquo;ve recently taken it upon myself to be in charge of backing up my family&rsquo;s digital files and photos.
It&rsquo;s not the most exciting thing, but God knows it won&rsquo;t get done otherwise and it is extremely important.</p>
<p>I&rsquo;m following the golden <a href="https://www.seagate.com/blog/what-is-a-3-2-1-backup-strategy/">3-2-1 backup rule</a>, to keep copies of our data in three separate locations,
in two different types of storage, and one offline backup. An example approach would be a copy of data in the cloud, on a cold (offline) hard drive, and another copy on a phone.
I already have copies on a hard disk and other devices covered, so that just leaves me with picking a cloud storage provider to go with.</p>
<p>Popular options like Apple iCloud and Google Drive are appealing because they offer a lot of storage space at a reasonable price, and make it easy to access files across devices.
And those names alone carry a lot of weight and security in their own right.</p>
<p>However, there are some serious privacy concerns with these services. Both Apple and Google scan the files uploaded to their cloud for various service reasons, such as improving user experience and app performance, but this ultimately means that they are analyzing the files that you upload. This can be worrying because it raises questions about who can see our data and how it might be used. Especially in light of recent events after Apple has proposed a <a href="https://www.bbc.co.uk/news/technology-58145943">new system to scan images</a> for child abuse material (&ldquo;CSAM&rdquo;).</p>
<h2 id="encrypted-cloud-storage">Encrypted cloud storage<a hidden class="anchor" aria-hidden="true" href="#encrypted-cloud-storage">¶</a></h2>
<p>That&rsquo;s why I&rsquo;m considering cloud providers that offer <a href="https://en.wikipedia.org/wiki/Zero-knowledge_service">zero-knowledge encryption</a>. With zero-knowledge encryption, even the service provider can&rsquo;t access my files because they don&rsquo;t have the keys to decrypt them. This means my data is much more secure and private. Only I can access my files, and I can be confident that no one else can see them.</p>
<p>We want to encrypt our files because it adds an extra layer of security. If someone were to gain unauthorized access to the cloud service, they wouldn&rsquo;t be able to read my files without the encryption key. This is especially important for sensitive information, like personal documents or financial records.</p>
<p>There are fortuantely a plethora of such services now available to consumers, so do your research and pick the service that seems right for you in terms of pricing.
For the purpose of this article, I will be using <a href="https://mega.nz/">MEGA</a> (formerly known as <a href="https://en.wikipedia.org/wiki/Megaupload">Mega Upload</a>, which is a different rabbit hole I recommend when you have the time).</p>
<p><figure>
    <img loading="lazy" src="/images/zero-knowledge.png"/> 
</figure>

<em>via <a href="https://tresorit.com/features/zero-knowledge-encryption">Tresorit</a></em></p>
<h2 id="file-encryption">File encryption<a hidden class="anchor" aria-hidden="true" href="#file-encryption">¶</a></h2>
<p>To go the extra mile, you can also consider encrypting your files <em>before</em> uploading them to any third-party storage service.
This may sound overkill, but it can also give you the peace of mind knowing your files are safe even if the cloud provider
or their keys become compromised. This means that only you can truly see your files. This also means that you have the burden
of safely storing and protecting your encryption keys at the risk of losing all of your data.</p>
<p>There are tons of popular encryption programs, but for this article I will be using <a href="https://itsfoss.com/cryptomator/">Cryptomator</a>.</p>
<figure>
    <img loading="lazy" src="/images/cryptomator-logo.png"/> 
</figure>

<h2 id="things-youll-need">Things you&rsquo;ll need<a hidden class="anchor" aria-hidden="true" href="#things-youll-need">¶</a></h2>
<p>Note: For this article, I will be using Windows. However, the steps are ultimately the same across any OS.</p>
<ul>
<li><a href="https://cryptomator.org/">Cryptomator</a> for encrypting files before uploading them to the cloud</li>
<li>A cloud storage provider, preferrably with a desktop app like <a href="https://mega.nz/desktop">MEGAsync</a></li>
<li>If you are backing up files larger than 4GB, <a href="https://github.com/dokan-dev/dokany/">Dokany</a></li>
</ul>
<h2 id="create-an-encrypted-vault">Create an encrypted vault<a hidden class="anchor" aria-hidden="true" href="#create-an-encrypted-vault">¶</a></h2>
<p>We need to create a Cryptomator &ldquo;vault&rdquo; to store and encrypt our files. Vaults are actually Windows <a href="https://medium.com/r?url=https%A%2F%2Fcomputer.howstuffworks.com%2Fvirtual-hard-drive1.htm">virtual drives</a>
that Cryptomator will mount whenever you unlock them and will persist in your drive&rsquo;s storage when they are locked.</p>
<p>Before we do that though, we need to decide what volume type we&rsquo;re going to be using: <a href="https://medium.com/r/?url=https%3A%2F%2Fcommunity.cryptomator.org%2Ft%2Fwebdav-vs-dokany-performance-comparison-when-using-remote-offsite-vault%2F2883%2F2">WebDAV or Dokany</a>.
Unless you&rsquo;re a &ldquo;power user&rdquo;,  <a href="https://medium.com/r/?url=https%3A%2F%2Fcommunity.cryptomator.org%2Ft%2Fwhat-is-dokan-file-system-driver%2F3369">according to a Cryptomator dev</a>, you really shouldn&rsquo;t worry about the
difference between the two and should probably go with Dokany. In my case, I actually needed Dokany
to transfer files larger than 4GB, which otherwise resulted in errors when I tried with WebDAV.
Download and install the <a href="https://medium.com/r/?url=https%3A%2F%2Fgithub.com%2Fdokan-dev%2Fdokany%2Freleases">newest release</a> of Dokany from GitHub and then return to Cryptomator.</p>
<figure>
    <img loading="lazy" src="/images/cryptomator-dokany.png"/> 
</figure>

<p>In Cryptomator, click on the &ldquo;Preferences&rdquo; gear icon in the top right and then go to &ldquo;Virtual Drive&rdquo;.
WebDAV should be selected by default. If you need to use Dokany, make sure you have installed the
newest release already and then select it from the drop down menu (there are only two options).</p>
<figure>
    <img loading="lazy" src="/images/cryptomator-main.png"/> 
</figure>

<p>Start by clicking &ldquo;Add Vault&rdquo; and name it. You&rsquo;ll then be prompted to create a password and optionally
receive a recovery key for said vault. A recovery key is the only way to recover a vault if you lose
this password. It is highly recommended to create a recovery key and store it somewhere safely, such
as a password manager- preferably one that has <a href="https://medium.com/r/?url=https%3A%2F%2Fcloudstorageinfo.org%2Fzero-knowledge-encryption-explained">zero-knowledge encryption</a>, in the spirit of our backup.</p>
<figure>
    <img loading="lazy" src="/images/cryptomator-create-vault.png"/> 
</figure>

<p>Now we&rsquo;re going to store this vault within the MEGA synced folder we created earlier.
Press the &ldquo;Custom Location&rdquo; button and then &ldquo;Choose&rdquo; and select the synced folder.
Either copy and paste the path of the MEGA folder or navigate to it in your file browser.
I placed my synced folder in my C: drive, so I will navigate there and then select it.</p>
<figure>
    <img loading="lazy" src="/images/cryptomator-vault-path.png"/> 
</figure>

<p>Now that our vault is prepared and placed in the synced folder, we can begin to transfer files to it.
First ensure that your vault is unlocked and then start transferring your files to it in File Explorer.
Transfer your files directly to the vault and not to the synced folder, or else anything you transfer
will be unencrypted. Your vault will appear as a virtual drive in File Explorer with the vault name and
an assigned letter- <code>vault_name (X:)</code>- this is where I dragged and dropped all of my files to.</p>
<p>You can check that you are doing things right by going to the synced folder and finding the now
encrypted contents that you transferred. In my synced folder, I found my files inside a hierarchy of
arbitrary sub-folders. Your files&rsquo; names will be obfuscated by Cryptomator and all files will have
the type <code>Cryptomator Encrypted Data (.c9r)</code>.</p>
<p>This is key: even though we can supposedly trust MEGA and its zero-knowledge encryption,
we really don&rsquo;t even need to now that our backup is entirely encrypted. This just adds another
layer of security on top of MEGA&rsquo;s <a href="https://medium.com/r/?url=https%3A%2F%2Fmega.io%2Fsecurity">User Controlled Encryption</a> and in theory removes the need to trust
MEGA in the first place. This revelation goes for any cloud storage provider and turns less private
alternatives like Google Drive and iCloud into more appealing choices based on their superior pricing models.</p>
<figure>
    <img loading="lazy" src="/images/mega-uploading.png"/> 
</figure>

<p>You can check the progress of your sync by running the MEGAsync application,
which may already be hidden in the tray on the right of your taskbar.
MEGA will try to sync multiple files simultaneously, but I noticed that
larger files like videos would only be uploaded one at a time.</p>
<h2 id="uploading-to-the-cloud">Uploading to the cloud<a hidden class="anchor" aria-hidden="true" href="#uploading-to-the-cloud">¶</a></h2>
<p>Now that the files are encrypted (as a .c9r), simply upload them to the cloud like you would any other file. I recommend a cloud provider has desktop sync app to make this
a continuous process that happens behind the scenes, so you don&rsquo;t have to worry about anything or risk forgetting to back something up.</p>
<h2 id="accessing-files-in-the-cloud">Accessing files in the cloud<a hidden class="anchor" aria-hidden="true" href="#accessing-files-in-the-cloud">¶</a></h2>
<p>Once the files are in the cloud, you can simply decrypt them with the key that you set earlier and be assured that only you have been able to read your data.</p>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/home-network/">
    <span class="title">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline></svg>&nbsp;Prev Page</span>
    <br>
    <span>Open-source routing and home network testing</span>
  </a>
</nav>

  </footer>
    <div class="comments-separator"></div>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2025 <a href="http://localhost:1313/">Corey Stone</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    <a href="http://localhost:1313/privacy">Privacy</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    <a href="http://localhost:1313/slashes">Slashes</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    <a href="https://github.com/coreystone/coreystone.github.io">Source</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

</body>

</html>
